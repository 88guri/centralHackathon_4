<!DOCTYPE html>
<html>
<head>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/deco.css' %}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>deco</title>
</head>
<body>
    <div class="deco-wrap">
        <button class="bak-button" type="button" onClick="history.go(-1)"><img src="{% static 'img/back-btn.svg' %}"> </button>
        
        <div class="char">
            <img id="character-image" class="char01-img" src="{% static 'images/default.png' %}">
        </div>
        <div class="box">
            <div class="nav-btn">
                <button class="decos-img" onclick="filterImages('all')"><img src="{% static 'img/deco/shop.svg' %}"> </button>
                <button class="shop-img" onclick="filterImages('cloth')"><img src="{% static 'img/deco/bag.svg' %}"> </button>
                <button class="jewel-img" onclick="filterImages('accessory')"><img src="{% static 'img/deco/jewel.svg' %}"> </button>
                <button class="face-img" onclick="filterImages('eyes')"><img src="{% static 'img/deco/face.svg' %}"> </button>
                <img class="nav-img" src="{% static 'img/deco/nav.svg' %}">
            </div>
            <div class="nav-box">
                <!-- 현재 보유한 아이템을 동적으로 생성 -->
                {% for user_item in user_items %}
                <button class="one-box" type="button" onclick="toggleCharacterItem('{{ user_item.item.name }}', '{{ user_item.item.image.url }}', '{% static 'img/deco_items/'|add:user_item.item.name|add:'.svg' %}')">
                    <img data-value="{{ user_item.item.name }}" src="{{ user_item.item.image.url }}">
                </button>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        // 캐릭터 레벨에 따라 이미지 바꾸는거
        document.addEventListener('DOMContentLoaded', function() {
            // 레벨 값을 가져옴 
            var characterLevel = {{ character.level|default:1 }};

            var imageElement = document.getElementById('character-image');
            
            // 레벨에 따라 이미지 소스 설정
            if (characterLevel >= 30) {
                imageElement.src = "{% static 'images/adult.png' %}";
            } else if (characterLevel >= 5) {
                imageElement.src = "{% static 'images/child.png' %}";
            } else {
                imageElement.src = "{% static 'images/default.png' %}";
            }
        });

        function filterImages(filter) {
            var boxes = document.querySelectorAll('.nav-box .one-box');
            boxes.forEach(function(box) {
                var img = box.querySelector('img');
                if (filter === 'all' || img.getAttribute('data-value') === filter) {
                    box.style.display = 'flex';
                } else {
                    box.style.display = 'none';
                }
            });
        }

        function toggleCharacterItem(type, src, decoSrc) {
            var charDiv = document.querySelector('.char');
            var existingItem = document.querySelector(`.char .char-${type}`);
            
            if (existingItem) {
                existingItem.remove();
            }

            var button = document.createElement('div');
            var div = document.createElement('div');
            var img = document.createElement('img');
            
            button.className = 'char-item';
            div.className = `char-${type}`;
            img.src = src;
            
            div.appendChild(img);
            button.appendChild(div);
            charDiv.appendChild(button);
        }
    </script>
</body>
</html>
